## Имя: Дорджиев Виктор
## Группа: ЭФМО-02-25
# Проект pz8-mongo

Задачи проекта
1)	Понять базовые принципы документной БД MongoDB (документ, коллекция, BSON, _id:ObjectID).
2)	Научиться подключаться к MongoDB из Go с использованием официального драйвера.
3)	Создать коллекцию, индексы и реализовать CRUD для одной сущности (например, notes).
4)	Отработать фильтрацию, пагинацию, обновления (в т.ч. частичные), удаление и обработку ошибок.


---

## Установка и запуск

(Необходимы предустановленные Go версии 1.25 и выше и Git)

Клонировать репозиторий:

```
git clone https://github.com/Unpatches/pz8-mongo
cd pz8-mongo
```

Команда запуска сервера:

```
go run ./cmd/server
```


------

## Структура проекта

```plaintext
pz8-mongo/                     
├── cmd/                  
│   └── server/             
│       └── main.go       
├── internal/              
│   └── db/               
│   │   └── mongo.go
│   └── notes/               
│       └── handler.go
│       └── model.go
│       └── repo.go          
├── go.mod                
└── go.sum       
```

## Отчёт о проделанной работе
### Создание заметки POST
```
http://185.250.46.179:8080/api/v1/notes
```

<img width="457" height="539" alt="image" src="https://github.com/user-attachments/assets/25353247-4032-451e-ae02-5ac9fbe88225" />


### Получить все заметки GET
```
http://185.250.46.179:8080/api/v1/notes?limit=11&skip=0
```

<img width="655" height="731" alt="image" src="https://github.com/user-attachments/assets/93cc406c-d7b1-418d-b41a-cd3076475953" />


### Получить все заметки по id GET
```
http://185.250.46.179:8080/api/v1/notes/6935e5e55ba8177ca66cc212
```

<img width="531" height="376" alt="image" src="https://github.com/user-attachments/assets/52e9a33d-5ce4-4d86-b94e-0cf9e0a8b5ea" />


### Обновить заметку PATCH
```
http://185.250.46.179:8080/api/v1/notes/6935e5e55ba8177ca66cc212
```

<img width="538" height="445" alt="image" src="https://github.com/user-attachments/assets/dfd67d80-288a-49b6-a386-f76d989df9b4" />


### Удалить заметку DELETE
```
http://185.250.46.179:8080/api/v1/notes/6935e5e55ba8177ca66cc212
```

<img width="536" height="343" alt="image" src="https://github.com/user-attachments/assets/d6f92021-0428-43e3-8884-75f390a79ccf" />


### Текстовый поиск GET
```
http://185.250.46.179:8080/api/v1/notes?q=MongoDB&limit=5&skip=0
```

<img width="647" height="463" alt="image" src="https://github.com/user-attachments/assets/4220df16-a605-444a-9dea-c071e67e133d" />


### Пагинация по курсору GET 
```
http://185.250.46.179:8080/api/v1/notes?limit=3
```
```
http://185.250.46.179:8080/api/v1/notes?limit=3&after=6935f0b75ba8177ca66cc21a
```


<img width="639" height="711" alt="image" src="https://github.com/user-attachments/assets/a24a0b0e-d2f0-4d7b-8ce9-0f624345c678" />


<img width="701" height="713" alt="image" src="https://github.com/user-attachments/assets/d268abbd-ae67-4cd6-8805-a02d9a2e8e71" />



# Контрольные вопросы
1) Данные хранятся в коллекциях документов, Каждый документ — это JSON-подобный объект (формат BSON), Документы могут иметь разные поля и вложенные структуры.
Удобнее т. к.
- Динамическая и изменяющаяся структура (например, заметки, профили пользователей, каталоги товаров),
- Хранение вложенных объектов (адреса, массивы тегов, списки
файлов).
- Высокая скорость вставки и выборки документов.
- Масштабирование по принципу sharding (распределение
коллекции по нескольким узлам).
2) ObjectID специальный тип _id, автоматически создаётся при вставке. Содержит время создания, случайное значение и счётчик —
гарантирует уникальность. Запросом GET по id.
3) Create, Read, Update, Delete
- set — устанавливает значение определённого поля. Если поле не существует, оно создаётся.
- unset — удаляет определённое поле.
- inc — увеличивает значение числового поля.
- push — добавляет элемент в массив.
- pull — удаляет элементы из массива.
4) Типы индексов:
- Обычный (по одному полю),
- Составной (по нескольким полям),
- Уникальный (не допускает дубликатов),
- TTL (документы удаляются автоматически после заданного
времени).
Нужно использовать метод db.notes.createIndex()
Можно вставить только одно значение с уникальным индексом. Повторное использование индекса приведет к ошибке
5) Это позволяет: 
- Завершать длинные операции — например, запросы, которые занимают слишком много времени.
- Отменять выполнение операции, которая больше не нужна — например, если клиент закрыл соединение.
Функция создаёт контекст с автоматической отменой по тайм-ауту. Если контекст истёк, возвращается ошибка, например, context.DeadlineExceeded. Также соединение с базой данных возвращается в пул соединений для повторного использования, что освобождает ресурсы



